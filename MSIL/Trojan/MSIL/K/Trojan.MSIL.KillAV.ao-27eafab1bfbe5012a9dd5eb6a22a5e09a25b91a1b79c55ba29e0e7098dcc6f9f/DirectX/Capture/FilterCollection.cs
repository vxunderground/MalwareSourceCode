// Decompiled with JetBrains decompiler
// Type: DirectX.Capture.FilterCollection
// Assembly: p, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 91D63E37-42E0-404C-97F4-07116ACD2D57
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare-00000-msil\Trojan.MSIL.KillAV.ao-27eafab1bfbe5012a9dd5eb6a22a5e09a25b91a1b79c55ba29e0e7098dcc6f9f.exe

using DShowNET;
using DShowNET.Device;
using System;
using System.Collections;
using System.Runtime.InteropServices;

namespace DirectX.Capture
{
  public class FilterCollection : CollectionBase
  {
    internal FilterCollection(Guid category) => this.getFilters(category);

    protected void getFilters(Guid category)
    {
      object o = (object) null;
      ICreateDevEnum createDevEnum = (ICreateDevEnum) null;
      UCOMIEnumMoniker ppEnumMoniker = (UCOMIEnumMoniker) null;
      UCOMIMoniker[] rgelt = new UCOMIMoniker[1];
      try
      {
        o = Activator.CreateInstance(Type.GetTypeFromCLSID(Clsid.SystemDeviceEnum));
        ((ICreateDevEnum) o).CreateClassEnumerator(ref category, out ppEnumMoniker, 0);
        while (ppEnumMoniker.Next(1, rgelt, out int _) == 0 && rgelt[0] != null)
        {
          this.InnerList.Add((object) new Filter(rgelt[0]));
          Marshal.ReleaseComObject((object) rgelt[0]);
          rgelt[0] = (UCOMIMoniker) null;
        }
        this.InnerList.Sort();
      }
      finally
      {
        createDevEnum = (ICreateDevEnum) null;
        if (rgelt[0] != null)
          Marshal.ReleaseComObject((object) rgelt[0]);
        rgelt[0] = (UCOMIMoniker) null;
        if (ppEnumMoniker != null)
          Marshal.ReleaseComObject((object) ppEnumMoniker);
        if (o != null)
          Marshal.ReleaseComObject(o);
      }
    }

    public Filter this[int index] => (Filter) this.InnerList[index];
  }
}
