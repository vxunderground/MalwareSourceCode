// Decompiled with JetBrains decompiler
// Type: RemoteServerService.MemeoBackgroundService
// Assembly: MemeoBackgroundService, Version=2.0.0.1, Culture=neutral, PublicKeyToken=null
// MVID: CEE04D16-EE80-4DF1-BC73-2B3D265B7030
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare-00000-msil\Trojan.Win32.Patched.mf-7baf9cb6986a2764176ef57b9ea6985a0cc189acc05703abad9996ef80e59ac1.exe

using MemeoRemoteCore.Logging;
using System;
using System.ComponentModel;
using System.Diagnostics;
using System.IO;
using System.Reflection;
using System.Runtime.Remoting;
using System.ServiceProcess;

namespace RemoteServerService
{
  internal class MemeoBackgroundService : ServiceBase
  {
    private Container components = (Container) null;

    public MemeoBackgroundService() => this.InitializeComponent();

    private static void Main() => ServiceBase.Run(new ServiceBase[1]
    {
      (ServiceBase) new MemeoBackgroundService()
    });

    private void InitializeComponent()
    {
      this.CanHandlePowerEvent = true;
      this.ServiceName = nameof (MemeoBackgroundService);
    }

    protected override void Dispose(bool disposing)
    {
      if (disposing && this.components != null)
        this.components.Dispose();
      base.Dispose(disposing);
    }

    protected override void OnStart(string[] args)
    {
      try
      {
        Logger.InitializeLogger();
        Logger.LogInfo("**********************Logger initialized(new instance of the Service)*******************");
        Logger.LogInfo("Configuring Remote Server...");
        RemotingConfiguration.Configure(Path.GetDirectoryName(Assembly.GetExecutingAssembly().Location) + "\\MemeoBackgroundService.exe.config", false);
        Logger.LogInfo("Done configuring.");
        this.EventLog.WriteEntry("Memeo Background Service Started!", EventLogEntryType.Information);
      }
      catch (Exception ex)
      {
        Logger.LogError("Service Start failure: " + ex.Message + " " + ex.StackTrace);
        this.EventLog.WriteEntry("Problem starting Memeo Background Service :" + ex.Message + ex.StackTrace, EventLogEntryType.Error);
      }
    }

    protected override void OnStop() => this.EventLog.WriteEntry("Memeo Background Service Stopped!", EventLogEntryType.Information);

    protected override bool OnPowerEvent(PowerBroadcastStatus powerStatus) => base.OnPowerEvent(powerStatus);
  }
}
