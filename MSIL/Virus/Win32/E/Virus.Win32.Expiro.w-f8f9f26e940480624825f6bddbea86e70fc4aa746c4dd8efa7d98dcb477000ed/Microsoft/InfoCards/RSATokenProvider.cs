// Decompiled with JetBrains decompiler
// Type: Microsoft.InfoCards.RSATokenProvider
// Assembly: infocard, Version=3.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089
// MVID: 1D4D5564-A025-490C-AF1D-DF4FBB709D1F
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare-00001-msil\Virus.Win32.Expiro.w-f8f9f26e940480624825f6bddbea86e70fc4aa746c4dd8efa7d98dcb477000ed.exe

using Microsoft.InfoCards.Diagnostics;
using System;
using System.IdentityModel.Selectors;
using System.IdentityModel.Tokens;

namespace Microsoft.InfoCards
{
  internal class RSATokenProvider : SecurityTokenProvider, IDisposable
  {
    private InfoCardPolicy m_policy;
    private InfoCard m_card;
    private SelfIssuedAuthProofToken m_RSAToken;

    public RSATokenProvider(InfoCardPolicy policy, InfoCard card)
    {
      InfoCardTrace.ThrowInvalidArgumentConditional(null == policy, nameof (policy));
      InfoCardTrace.ThrowInvalidArgumentConditional(null == card, nameof (card));
      this.m_policy = policy;
      this.m_card = card;
    }

    public void Dispose()
    {
      if (this.m_RSAToken == null)
        return;
      this.m_RSAToken.Dispose();
      this.m_RSAToken = (SelfIssuedAuthProofToken) null;
    }

    protected override SecurityToken GetTokenCore(TimeSpan timeout)
    {
      if (this.m_RSAToken == null)
        this.m_RSAToken = new SelfIssuedAuthProofToken(this.m_card.GetPrivateCryptography(this.m_policy.Recipient.GetIdentifier()), DateTime.UtcNow + timeout);
      return (SecurityToken) this.m_RSAToken;
    }
  }
}
